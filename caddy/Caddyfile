:80 {
    root * /var/www/html
    file_server
    
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }

    php_fastcgi 127.0.0.1:9000

    redir /.well-known/carddav /remote.php/dav 301
    redir /.well-known/caldav /remote.php/dav 301

    @forbidden {
        path /.htaccess
        path /data/*
        path /config/*
        path /db_structure
        path /.xml
        path /README
        path /3rdparty/*
        path /lib/*
        path /templates/*
        path /occ
        path /console.php
    }

    respond @forbidden 404
}

:9981 {
    encode gzip zstd
	@collabora {
		path /browser/* # Browser is the client part of LibreOffice Online
		path /hosting/discovery # WOPI discovery URL
		path /hosting/capabilities # Show capabilities as json
		path /cool/* # Main websocket, uploads/downloads, presentations and admin
	}

	reverse_proxy @collabora https://127.0.0.1:9980 {
		header_up Host {host}
		header_up Connection "Upgrade"
		header_up Upgrade websocket
		transport http {
			tls_insecure_skip_verify
		}
	}

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }
}